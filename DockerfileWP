FROM gcr.io/jellyfish-development-167809/wordpress-wordpress:0.0.0.2

RUN apk update \
    && apk upgrade \
    && apk add --no-cache ca-certificates cachefilesd e2fsprogs-extra \
    && mkdir /home/wordpress

RUN mkdir /media/cache && chmod 777 -R /media/cache
RUN mkdir /media/uploads && chmod 777 -R /media/uploads
COPY wordpress/wordpress-php.ini /usr/local/etc/php/conf.d/wordpress-php.ini
COPY gke/wordpress/wordpress-entrypoint-nr.sh /usr/local/bin/wordpress-entrypoint.sh
COPY wordpress/wp-config.php /home/wordpress/wp-config.php
COPY wordpress/db-config.php /home/wordpress/db-config.php
ADD wordpress/wp-content /home/wordpress/wp-content

WORKDIR "/var/www/html/"
ENTRYPOINT ["wordpress-entrypoint.sh"]

CMD ["php-fpm"] 
