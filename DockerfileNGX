FROM nginx:1.10.0

RUN apt-get update
RUN apt-get install curl fuse nfs-common -y 
  
RUN curl -L -O https://github.com/GoogleCloudPlatform/gcsfuse/releases/download/v0.23.0/gcsfuse_0.23.0_amd64.deb
RUN dpkg --install gcsfuse_0.23.0_amd64.deb
RUN rm -rf gcsfuse_0.23.0_amd64.deb

RUN mkdir /media/cache 
COPY gke/nginx/nginx-entrypoint.sh /usr/local/bin/nginx-entrypoint.sh
RUN chmod +x /usr/local/bin/nginx-entrypoint.sh 
COPY nginx/conf/nginx.conf /etc/nginx/nginx.conf
COPY gke/nginx/default.conf /etc/nginx/conf.d/default.conf

ENTRYPOINT ["./usr/local/bin/nginx-entrypoint.sh"]

STOPSIGNAL SIGQUIT

CMD ["nginx", "-g", "daemon off;"]
